name: Test

on:
   workflow_call:
    inputs:
      go-version:
        required: true
        type: string

jobs:
  analyse:
    name: run all go tests
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-go@v2
        with:
          go-version: ${{ inputs.go-version }}
      - name: test
        run: go test ./... -race -coverprofile=coverage.txt -covermode=atomic
      - name: upload code coverage
        uses: codecov/codecov-action@v2.1.0
        with:
          file: coverage.txt
          token: ${{ secrets.CODECOV_TOKEN }}
